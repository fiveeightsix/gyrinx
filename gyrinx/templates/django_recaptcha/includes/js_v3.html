{# The provided implementation caters for only one reCAPTCHA on a page. Override this template and its logic as needed. #}
<script nonce="{{request.csp_nonce}}"
        src="https://{{ recaptcha_domain }}/recaptcha/enterprise.js?render={{ public_key }}{% if api_params %}&{{ api_params }}{% endif %}"></script>
<script nonce="{{request.csp_nonce}}">
    var element
    grecaptcha.enterprise.ready(function() {
        element = document.querySelector('.g-recaptcha[data-widget-uuid="{{ widget_uuid }}"]');
        element.form.addEventListener('submit', recaptchaFormSubmit);
    });
    function recaptchaFormSubmit(event) {
        event.preventDefault();
        {% if action %}
        grecaptcha.enterprise.execute('{{ public_key }}', {action: '{{ action|escape }}'})
        {% else %}
        grecaptcha.enterprise.execute('{{ public_key }}', {})
        {% endif %}
        .then(function(token) {
            console.log("reCAPTCHA validated for 'data-widget-uuid=\"{{ widget_uuid }}\"'. Setting input value...")
            element.value = token || "unknown";
            element.form.submit();
        }, function (error) {
            console.error("reCAPTCHA validation failed for 'data-widget-uuid=\"{{ widget_uuid }}\"'.", error);
        });
    }
</script>
